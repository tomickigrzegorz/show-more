!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).ShowMore=e()}(this,function(){"use strict";const t=["table","thead","tbody","tfoot","tr","td","th","ul","ol","li","dl","dt","dd","figure","figcaption","img","picture","source","video","audio","iframe","object","embed","canvas","svg","script","style","form","input","select","textarea","button"],e={typeElement:"span",more:!1,less:!1,number:!1,nobutton:!1,after:0,btnClass:"show-more-btn",btnClassAppend:null,removeElements:t},s=(t,e)=>{const s="table"===e?t.rows:t.children;if(!s)return"";const n=Array.from(s).filter(t=>t.classList.contains("hidden")).length;return 0!==n?` ${n}`:""},n=(t,e)=>{const s=r("div");s.insertAdjacentHTML("afterbegin",t);let n=e;return function t(e,s){let n=e.firstChild;for(;n;)3===n.nodeType?s(n):1===n.nodeType&&n.childNodes&&n.childNodes[0]&&t(n,s),n=n.nextSibling}(s,function(t){if(n>0){const e=t.data.length;n-=e,n<=0&&(t.data=t.substringData(0,t.data.length+n))}else t.data=""}),(t=>{t.querySelectorAll("table").forEach(t=>{t.querySelectorAll("tr").forEach(t=>{const e=t.querySelectorAll("td, th");e.length>0&&Array.from(e).every(t=>!t.textContent?.trim())&&t.remove()})})})(s),(t=>{let e,s=t;do{e=s,s=s.replace(/<((?!td|th|tr)\w+)(\s[^>]*)?>(\s|&nbsp;|<br\s*\/?>)*<\/\1>/gi,"")}while(s!==e);return s})(s.innerHTML)},i=(t,e=!1)=>{t.classList[e?"add":"remove"]("hidden")},o=(t,e)=>{for(const s in e)t.setAttribute(s,String(e[s]))},r=t=>document.createElement(t),l={newLine:{match:/(\r\n|\n|\r)/gm,replace:" "},space:{match:/\s\s+/gm,replace:" "},br:{match:/<br\b[^>]*\/?>/gim,replace:" "},html:{match:/(<((?!\/?(?:b|strong|i|em|u|mark|small|sub|sup)\b)[^>]+)>)/gi,replace:""}};return class{constructor(a,c={}){this.t=!1,this.i=()=>{const{element:e,after:s=0,ellipsis:l,nobutton:a,limit:c=0,type:h}=this.o;o(e,{"showmore-expanded":"false"});const f=c+s,d=!1===l?"":"...";if("text"===h){const s=e.innerHTML.trim();if((e.textContent?.trim()||"").length>f){const i=this.o.removeElements||[];let o=((t,e)=>{const s=r("div");return s.innerHTML=t,e.forEach(t=>{s.querySelectorAll(t).forEach(t=>{t.remove()})}),s.innerHTML})(s,i);const l=JSON.stringify(i)!==JSON.stringify(t);for(const t of Object.values(this.l))if(t?.match){if(l&&t===this.l.html)continue;o=o.replace(t.match,t.replace)}const h=n(o,c-1).concat(d);e.textContent="",e.insertAdjacentHTML("beforeend",h),this.h(e,{...this.o,originalText:s,truncatedText:h}),a||this.m(this.o)}return}if("list"===h||"table"===h){const t=this.p(e,h);if(t.length>f){for(let e=c;e<t.length;e++)i(t[e],!0);a||this.m(this.o),this.h("list"===h?e:e.nextElementSibling,this.o)}}},this.h=(t,e)=>{t&&t.addEventListener("click",this.u.bind(this,e))},this.T=t=>{const{element:e,number:n,less:i,more:l,type:a,btnClass:c,btnClassAppend:h}=t,f=this.t?i||"":l||"";let d=this.t?i.trim()||"collapse":l.trim()||"expand";const m=n?s(e,a||""):"";d=n?d+m:d;const p=r("button");return p.className=null==h?c:`${c} ${h}`,o(p,{"aria-expanded":this.t,"aria-label":d,tabindex:0}),p.insertAdjacentHTML("beforeend",n?f+m:f),p},this.u=(t,e)=>{const{target:s}=e;if(!(s instanceof HTMLElement))return;const{element:n,type:o,limit:l=0,less:a,typeElement:c,originalText:h,truncatedText:f,btnClass:d}=t;if(!s.classList.contains(d))return;const m=n.getAttribute("showmore-expanded");if(this.t="false"===m,"text"===o&&(n.textContent="",n.insertAdjacentHTML("beforeend",this.t?h||"":f||""),a)){const e=r(c);e.classList.add("show-more-wrapper");const s=this.T(t);s&&e.insertAdjacentElement("beforeend",s),n.appendChild(e)}if("list"===o||"table"===o){const t=this.p(n,o);if("false"===m)for(let e=l;e<t.length;e++)i(t[e],!1);else{const e="list"===o?t.length-1:t.length;for(let s=l;s<e;s++)i(t[s],!0)}}o&&this.A({...t,target:s})},this.p=(t,e)=>"list"===e?Array.from(t.children):t.rows,this.m=t=>{const{type:e,element:s,more:n,typeElement:i}=t;if(n)if("table"===e)s.insertAdjacentElement("afterend",this.T(t));else{const e=r(i);e.classList.add("show-more-wrapper"),e.appendChild(this.T(t)),s.appendChild(e)}},this.A=t=>{const{element:e,type:n,less:i,more:r,number:l,target:a}=t;if(!(a instanceof HTMLElement))return;const c=this.t?i:r,h=this.t?"expand":"collapse",f=e.lastElementChild,d=l?s(e,n||""):"",m=l?c+d:c;o(e,{"showmore-expanded":this.t}),o(a,{"aria-expanded":this.t,"aria-label":m}),this.v(h,t),c?a.innerHTML=l?c+d:c:"table"===n?a.parentNode?.removeChild(a):"list"===n&&f?.parentNode&&f.parentNode.removeChild(f)};const{onMoreLess:h=()=>{},regex:f={},config:d}=c,m=Array.from(document.querySelectorAll(a));this.v=h,this.l={...l,...f},m.forEach((t,s)=>{const n=t.getAttribute("data-config"),i=n?JSON.parse(n):{},o={...d,...i};this.o={index:s,classArray:t.classList,...e,...o,typeElement:o.element||"span",element:t},this.i()})}}});
